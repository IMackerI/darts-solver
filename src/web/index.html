<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Darts Solver</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav id="sidebar">
        <div class="sidebar-header">
            <span class="logo-icon">ðŸŽ¯</span>
            <h1>Darts Solver</h1>
        </div>
        <ul class="nav-links">
            <li><a href="#/" class="nav-link active" data-page="landing"><span class="nav-icon">âŒ‚</span>Home</a></li>
            <li><a href="#/calibrate" class="nav-link" data-page="calibration"><span class="nav-icon">âŠ•</span>Calibration</a></li>
            <li><a href="#/solve" class="nav-link" data-page="solver"><span class="nav-icon">â—‰</span>Solver</a></li>
        </ul>
        <div class="sidebar-footer">
            <div id="wasm-status" class="status loading">Loading WASMâ€¦</div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main id="content">

        <!-- Landing Page -->
        <section id="page-landing" class="page active">
            <div class="page-inner">
                <div class="hero">
                    <div class="hero-badge">WebAssembly Powered</div>
                    <h2>Darts Solver</h2>
                    <p class="lead">
                        Find the optimal aiming strategy for any game state using probabilistic modelling
                        and Monte Carlo simulation â€” all running in your browser.
                    </p>
                </div>

                <div class="card-grid">
                    <div class="card card--step">
                        <div class="card-step-num">01</div>
                        <h3>Calibrate</h3>
                        <p>
                            Throw darts at the bull's-eye and click where they land.
                            The solver estimates your personal accuracy distribution.
                        </p>
                        <a href="#/calibrate" class="btn btn-card">Start Calibration â†’</a>
                    </div>
                    <div class="card card--step">
                        <div class="card-step-num">02</div>
                        <h3>Solve</h3>
                        <p>
                            Pick a game state and see the optimal aim point, expected throws
                            to finish, and a heatmap of scores across the board.
                        </p>
                        <a href="#/solve" class="btn btn-card">Open Solver â†’</a>
                    </div>
                </div>

                <div class="info-section">
                    <h3>How it works</h3>
                    <ul>
                        <li><strong>Your accuracy</strong> is modelled as a 2D Gaussian distribution estimated from your calibration shots.</li>
                        <li><strong>Dynamic programming</strong> finds the aim point that minimises expected throws for any state.</li>
                        <li><strong>Heatmaps</strong> visualise expected throws or expected points across every possible aim point.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Calibration Page -->
        <section id="page-calibration" class="page">
            <div class="page-inner page-inner--wide">
                <h2>Calibration</h2>
                <p class="subtitle">Aim at the bull's-eye and click where your darts actually land.</p>

                <div class="two-col">
                    <!-- Canvas column -->
                    <div class="canvas-wrap">
                        <canvas id="calibration-canvas" width="700" height="700"></canvas>
                    </div>

                    <!-- Controls column -->
                    <div class="controls-panel">
                        <div class="control-group">
                            <h3><span class="cg-icon">â—Ž</span>Shots</h3>
                            <p id="shot-count">0 shots recorded</p>
                            <div class="btn-row">
                                <button id="btn-undo" class="btn btn-secondary" disabled>Undo Last</button>
                                <button id="btn-clear" class="btn btn-danger" disabled>Clear All</button>
                            </div>
                        </div>

                        <div class="control-group">
                            <h3><span class="cg-icon">â¬¡</span>Distribution</h3>
                            <div id="distribution-info" class="info-box">
                                <p class="muted">Record at least 3 shots to estimate your distribution.</p>
                            </div>
                            <button id="btn-estimate" class="btn" disabled>Estimate Distribution</button>
                        </div>

                        <div class="control-group">
                            <h3><span class="cg-icon">â¬‡</span>Data</h3>
                            <div class="btn-row">
                                <button id="btn-export" class="btn btn-secondary" disabled>Export</button>
                                <button id="btn-import" class="btn btn-secondary">Import</button>
                            </div>
                            <input type="file" id="import-file" accept=".json" hidden>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Solver Page -->
        <section id="page-solver" class="page">
            <div class="page-inner page-inner--wide">
                <h2>Solver</h2>
                <p class="subtitle" id="solver-subtitle">Configure and solve for optimal dart strategy.</p>

                <div class="two-col">
                    <!-- Canvas column -->
                    <div class="canvas-wrap">
                        <div class="canvas-toolbar">
                            <label class="toggle-label toggle-label--inline">
                                <input type="checkbox" id="show-heatmap">
                                <span>Heatmap</span>
                            </label>
                        </div>
                        <canvas id="solver-canvas" width="700" height="700"></canvas>
                    </div>

                    <!-- Controls column -->
                    <div class="controls-panel">
                        <div class="control-group">
                            <h3><span class="cg-icon">âš™</span>Game Settings</h3>
                            <label class="field">
                                <span>Game Mode</span>
                                <select id="game-mode">
                                    <option value="finishOnDouble">Finish on Double</option>
                                    <option value="finishOnAny">Finish on Any</option>
                                </select>
                            </label>
                            <label class="field">
                                <span>State (points remaining)</span>
                                <div class="state-nav">
                                    <button id="btn-state-prev" class="btn btn-secondary btn-arrow" title="Previous state (â†)">â—€</button>
                                    <input type="number" id="game-state" min="1" max="501" value="501">
                                    <button id="btn-state-next" class="btn btn-secondary btn-arrow" title="Next state (â†’)">â–¶</button>
                                </div>
                            </label>
                        </div>

                        <div class="control-group">
                            <h3><span class="cg-icon">â—ˆ</span>Solver</h3>
                            <label class="field">
                                <span>Solver Type</span>
                                <select id="solver-type">
                                    <option value="minThrows">Minimize Throws (DP)</option>
                                    <option value="maxPoints">Maximize Points (Greedy)</option>
                                </select>
                            </label>
                            <label class="field">
                                <span>Aim Samples</span>
                                <input type="number" id="aim-samples" min="100" max="50000" value="5000">
                            </label>
                            <button id="btn-solve" class="btn">Solve</button>
                        </div>

                        <div class="control-group">
                            <h3><span class="cg-icon">â˜…</span>Results</h3>
                            <div id="solve-results" class="info-box">
                                <p class="muted">Press Solve to compute the optimal strategy.</p>
                            </div>
                        </div>

                        <div class="control-group">
                            <h3><span class="cg-icon">âŠž</span>Visualization</h3>
                            <label class="field" id="heatmap-res-field" style="display:none">
                                <span>Heatmap Resolution</span>
                                <select id="heatmap-resolution">
                                    <option value="30">30 Ã— 30 (fast)</option>
                                    <option value="50" selected>50 Ã— 50</option>
                                    <option value="100">100 Ã— 100 (slow)</option>
                                </select>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="overlay hidden">
        <div class="spinner"></div>
        <p id="loading-message">Computing...</p>
    </div>

    <script src="darts_wasm.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
